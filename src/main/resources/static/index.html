<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUP Export Builder - EssentialSync</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/dup-export.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📦 DUP Export Builder</h1>
            <p>Build Custom Data Update Packages from Essential Architecture Studio</p>
        </div>

        <div class="export-builder">
            <!-- Configuration Section -->
            <div class="card config-section">
                <h3>🔧 Export Configuration</h3>
                <div class="form-group">
                    <label for="repoSelect">EAS Repository:</label>
                    <select id="repoSelect" class="form-control" onchange="handleRepositoryChange()" required>
                        <option value="">-- Select a repository --</option>
                    </select>
                    <small>Select the EAS repository to export from</small>
                </div>
                <div class="form-group">
                    <label for="repoName">External Repository Name:</label>
                    <input type="text" id="repoName" class="form-control"
                           placeholder="Enter repository name (e.g., MyExternalSystem)"
                           required>
                    <small>This name will be used to associate exported instances</small>
                </div>
                <div class="form-group">
                    <label for="idPrefix">ID Prefix (Optional):</label>
                    <input type="text" id="idPrefix" class="form-control"
                           placeholder="Enter ID prefix (e.g., MY_PREFIX)"
                           pattern="[A-Za-z0-9_]*">
                    <small>Instance IDs will be transformed to {PREFIX}_{NUMBER}. IDs already starting with this prefix will be preserved. Leave empty to keep original IDs.</small>
                </div>
            </div>

            <!-- Class and Field Selection Section -->
            <div class="card class-selection-section">
                <div class="section-header">
                    <h3>📋 Select Classes and Fields</h3>
                </div>

                <!-- Two-panel layout -->
                <div class="two-panel-layout">
                    <!-- Left Panel: Class List -->
                    <div class="panel left-panel">
                        <div class="panel-header">
                            <h4>Classes</h4>
                            <input type="text" id="classSearchInput" class="search-input"
                                   placeholder="🔍 Search classes..."
                                   oninput="filterClasses(this.value)">
                        </div>
                        <div id="classList" class="class-list">
                            <!-- Classes will be populated here -->
                        </div>
                    </div>

                    <!-- Right Panel: Field Selection -->
                    <div class="panel right-panel">
                        <div class="panel-header">
                            <h4>Fields</h4>
                            <div id="currentClassName" class="current-class-name">
                                Select a class to view its fields
                            </div>
                        </div>
                        <div id="fieldsList" class="fields-list">
                            <!-- Fields will be populated here when a class is selected -->
                            <div class="empty-state">
                                <p>👈 Select a class from the left panel to view and select its fields</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Selected Classes Summary -->
                <div class="selected-summary">
                    <h4>📌 Selected Classes</h4>
                    <div id="selectedSummary" class="summary-content">
                        <p class="no-selection">No classes selected yet</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card action-section">
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="generateExport()" id="generateBtn" disabled>
                        🚀 Generate DUP Export
                    </button>
                    <button class="btn btn-secondary" onclick="saveSelection()" id="saveBtn" disabled>
                        💾 Save Selection
                    </button>
                    <button class="btn btn-secondary" onclick="loadSelection()" id="loadBtn">
                        📂 Load Selection
                    </button>
                    <button class="btn btn-warning" onclick="resetForm()">
                        🔄 Reset Form
                    </button>
                </div>
                <div id="exportStatus" class="export-status"></div>
            </div>
        </div>
    </div>

    <!-- Progress Overlay -->
    <div id="progressOverlay" class="progress-overlay" style="display: none;">
        <div class="progress-modal">
            <div class="progress-spinner"></div>
            <h3 id="progressTitle">Generating DUP Export...</h3>
            <p id="progressMessage">Please wait while we process your export</p>
            <div class="progress-details" id="progressDetails"></div>
        </div>
    </div>

    <script src="js/dup-export.js"></script>
</body>
</html>
